
{% extends "_layout.html" %}

{% block title %}Equities{% endblock %}

{% block content %}
<div class="equities-container">
    <div class="header-section">
        <h1>Equities Analysis</h1>
        <div class="filters">
            <input type="number" placeholder="Min Price" id="min-price">
            <input type="number" placeholder="Max Price" id="max-price">
            <select id="sector-filter">
                <option value="">All Sectors</option>
                <option value="Banking">Banking</option>
                <option value="IT">IT</option>
                <option value="Energy">Energy</option>
            </select>
            <button onclick="applyFilters()">Apply Filters</button>
        </div>
    </div>
    
    <div class="equities-table-container">
        <table class="equities-table">
            <thead>
                <tr>
                    <th>Symbol</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Change</th>
                    <th>Change %</th>
                    <th>Sector</th>
                    <th>Volume</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="equities-body">
                <!-- Data will be loaded via JavaScript -->
            </tbody>
        </table>
    </div>
</div>

<script>
// Load equities data
async function loadEquities() {
    try {
        const response = await fetch('/api/equities/list');
        const data = await response.json();
        
        const tbody = document.getElementById('equities-body');
        tbody.innerHTML = data.items.map(item => `
            <tr>
                <td>${item.symbol}</td>
                <td>${item.name}</td>
                <td>‚Çπ${item.price.toFixed(2)}</td>
                <td class="${item.change >= 0 ? 'positive' : 'negative'}">
                    ${item.change >= 0 ? '+' : ''}${item.change.toFixed(2)}
                </td>
                <td class="${item.change_percent >= 0 ? 'positive' : 'negative'}">
                    ${item.change_percent >= 0 ? '+' : ''}${item.change_percent.toFixed(2)}%
                </td>
                <td>${item.sector}</td>
                <td>${item.volume.toLocaleString()}</td>
                <td>
                    <button class="pin-btn">‚≠ê</button>
                    <button class="lock-btn">üîí</button>
                </td>
            </tr>
        `).join('');
    } catch (error) {
        console.error('Failed to load equities:', error);
    }
}

function applyFilters() {
    const minPrice = document.getElementById('min-price').value;
    const maxPrice = document.getElementById('max-price').value;
    const sector = document.getElementById('sector-filter').value;
    
    const params = new URLSearchParams();
    if (minPrice) params.append('min_price', minPrice);
    if (maxPrice) params.append('max_price', maxPrice);
    if (sector) params.append('sector', sector);
    
    fetch(`/api/equities/list?${params}`)
        .then(response => response.json())
        .then(data => {
            const tbody = document.getElementById('equities-body');
            tbody.innerHTML = data.items.map(item => `
                <tr>
                    <td>${item.symbol}</td>
                    <td>${item.name}</td>
                    <td>‚Çπ${item.price.toFixed(2)}</td>
                    <td class="${item.change >= 0 ? 'positive' : 'negative'}">
                        ${item.change >= 0 ? '+' : ''}${item.change.toFixed(2)}
                    </td>
                    <td class="${item.change_percent >= 0 ? 'positive' : 'negative'}">
                        ${item.change_percent >= 0 ? '+' : ''}${item.change_percent.toFixed(2)}%
                    </td>
                    <td>${item.sector}</td>
                    <td>${item.volume.toLocaleString()}</td>
                    <td>
                        <button class="pin-btn">‚≠ê</button>
                        <button class="lock-btn">üîí</button>
                    </td>
                </tr>
            `).join('');
        });
}

// Load data on page load
document.addEventListener('DOMContentLoaded', loadEquities);
</script>
{% endblock %}
